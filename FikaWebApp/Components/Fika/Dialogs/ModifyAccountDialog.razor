@using System.Text.RegularExpressions
@using FikaWebApp.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.Extensions.Options

@inject RoleManager<IdentityRole> RoleManager
@inject IOptions<IdentityOptions> IdentityOptions

<MudDialog>
	<DialogContent>
		<MudForm @bind-IsValid="@_success" @bind-Errors="@_errors" Spacing="4">
			
			<MudSelect MultiSelection="true" Placeholder="Select roles..." HelperText="Role Selection" @bind-Value="_roleValue" @bind-SelectedValues="_selectedRoles">
				@foreach (var role in _availableRoles)
				{
					<MudSelectItem T="string" Value="@role">@role</MudSelectItem>
				}
			</MudSelect>
			<MudStack Row Justify="Justify.Center" Spacing="2">
				<MudPaper Class="pa-4 mt-4">
					<MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!_success)" Class="ml-auto" OnClick="Submit">Add</MudButton>
					<MudButton Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" OnClick="Cancel">Cancel</MudButton>
				</MudPaper>
			</MudStack>
		</MudForm>
	</DialogContent>
</MudDialog>

@code {
	[CascadingParameter]
	private IMudDialogInstance MudDialog { get; set; }

	private IEnumerable<string> _selectedRoles = new HashSet<string>();
	private string[] _availableRoles = [];
	private string _roleValue = "None";

	private bool _success;
	private string[] _errors = { };

	protected override void OnInitialized()
	{
		base.OnInitialized();

		_availableRoles = RoleManager.Roles
			.Select(r => r.Name)
			.ToArray();
	}

	private void Submit()
	{
		MudDialog.Close(_selectedRoles.ToList());
	}

	private void Cancel()
	{
		MudDialog.Cancel();
	}
}
