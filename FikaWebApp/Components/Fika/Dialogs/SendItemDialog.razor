@using FikaShared.Requests
<MudDialog>
	<DialogContent>
		<MudStack Spacing="4">
			<MudText>Input a MongoId and a valid amount to send</MudText>
			<MudTextField @bind-Value="@_model.TemplateId" Placeholder="The MongoId to send"
				Validation="@(new Func<string, string>(Statics.ValidateMongoId))" Immediate="true" OnlyValidateIfDirty="true" />
			<MudNumericField @bind-Value="@_model.Amount" Placeholder="How many items to send" Min="0" Max="9999" />
			<FikaMultiLineTextField @bind-Value="@_model.Message" />
			<MudCheckBox Label="Specific Date" @bind-Value="_model.UseDate" Color="Color.Info" />
			<MudDatePicker Label="Send Date" Editable="true" @bind-Date="_model.Date" Placeholder="Select Date" Disabled="!_model.UseDate" ImmediateText />
			<MudTimePicker Label="Send Time" Editable="true" @bind-Time="_time" Placeholder="Select Time" Disabled="!_model.UseDate" MinuteSelectionStep="5" ImmediateText />
		</MudStack>
	</DialogContent>
	<DialogActions>
		<MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.CheckCircle" Disabled="@(CanConfirm())" OnClick="Confirm">Confirm</MudButton>
		<MudButton Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Cancel" OnClick="Cancel">Cancel</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter]
	private IMudDialogInstance MudDialog { get; set; }

	private SendItemModel _model = new();
	private TimeSpan? _time;

	private bool CanConfirm()
	{
		return _model.UseDate && (_model.Date == null || _time == null);
	}

	private void Confirm()
	{
		// if (!CanConfirm())
		// {
		// 	return;
		// }

		_model.Date = _model.Date + _time;
		MudDialog.Close(_model);
	}

	private void Cancel()
	{
		MudDialog.Cancel();
	}

	public class SendItemModel
	{
		public string TemplateId { get; set; } = string.Empty;
		public int Amount { get; set; } = 1;
		public string Message { get; set; } = string.Empty;

		public bool UseDate { get; set; }
		public DateTime? Date { get; set; }
	}
}
